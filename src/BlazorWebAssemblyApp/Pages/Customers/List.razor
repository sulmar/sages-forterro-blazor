@page "/customers"
@using BlazorWebAssemblyApp.Models

<h3>Customer List</h3>

<div>
    <form method="post">
        <label for="searchText">Type search text:</label>
        <input type="text" id="searchText" name="searchText" @bind="@searchText" @bind:after="@HandleSearch" @bind:event="oninput" />
        <button type="button" @onclick="HandleSearch" class="btn btn-primary">Search</button>
    </form>
</div>


<CascadingValue Value="@info">
    <LoaderComponent Items="@customers">
        <CustomersTable Customers="@customers" />
    </LoaderComponent>
</CascadingValue>

<p>SelectedCustomerId: @Filter.SelectedCustomerId</p>

@code {
    private CancellationTokenSource cts;

    private string title = "Loading Customers...";

    private int customerCount = 100;

    private string description = "Lorem ipsum";

    private Info info => new Info { Title = title, Description = description, Count = customerCount };

    private string searchText = "a";

    [Parameter]
    public int DebounceMiliseconds { get; set; } = 500;

    private async Task HandleSearch()
    {
        cts?.Cancel();
        cts = new CancellationTokenSource();

        var token = cts.Token;

        try
        {
            await Task.Delay(DebounceMiliseconds, token);

            if (!token.IsCancellationRequested)
            {
                Console.WriteLine(searchText);
            }
        }
        catch(TaskCanceledException) {}
    }

}